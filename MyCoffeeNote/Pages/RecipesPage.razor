@page "/"
@using MyCoffeeNote.Domain.Entities


<PageTitle>Ваши рецепты</PageTitle>

<MudDataGrid Items="@AllRecipes" T="Recipe" @ref="MudDataGrid"
             Dense="true" Striped="true" Bordered="true" ReadOnly="false"
             EditMode="DataGridEditMode.Cell"
             EditTrigger="DataGridEditTrigger.OnRowClick"
             CommittedItemChanges="@CommittedItemChanges"
             SortMode="SortMode.Single">
    <ToolBarContent>
        <MudSpacer />
        <MudItem Style="margin-right: 1%;">
            <MudButton OnClick="@AddNewLine" Variant="Variant.Outlined"
                       EndIcon="@Icons.Material.Outlined.AddCircleOutline">
                Добавить новый рецепт
            </MudButton>
        </MudItem>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.Description"></PropertyColumn>
        @foreach (string column in AllUniqColumns.OrderBy(s => s))
        {
            <TemplateColumn Title="@column" T="Recipe" IsEditable="false">
                <CellTemplate>
                    <MudStack Row>
                        <MudTextField T="string" Variant="Variant.Text" 
                                      Value="@(GetCellValue(context.Item, column))"
                                      ValueChanged="@(newValue => CellValueChanged(newValue, column, context.Item))"></MudTextField>
                    </MudStack>
                </CellTemplate>
            </TemplateColumn> 
        }
        <TemplateColumn Title="Введите имя нового столбца" IsEditable="false" >
            <CellTemplate>
                <MudStack Row>
                    <MudTextField T="string" Variant="Variant.Text"
                                  ValueChanged="@(newValue => CellValueChanged(newValue, newValue, context.Item))"></MudTextField>
                </MudStack>
            </CellTemplate>
        </TemplateColumn>
        <PropertyColumn Property="x => x.CreationDate.ToLongTimeString()" IsEditable="false" ></PropertyColumn>
        <TemplateColumn IsEditable="false" >
            <CellTemplate>
                <MudButton OnClick="@(() => DeleteLine(context))" Variant="Variant.Outlined"
                           EndIcon="@Icons.Material.Filled.RemoveCircleOutline">Удалить</MudButton>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
    
</MudDataGrid>
